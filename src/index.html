<!DOCTYPE html>
<html> 
    <head>
        <meta charset="utf-8">
        <title>Chord Information Calculator</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
        <script data-main = "chords.js" src = "require.js"></script>
        <style>
            .white-key {
              width: 30px;
              height: 100px;
              background-color: white;
              border: 1px solid black;
              float: left;
              position: relative;
              margin-right: -1px;
              display: flex;
              justify-content:center;
              align-items: end;
              color:black;
              z-index: 0;
              vertical-align: text-bottom;
            }
            
            .black-key {
              width: 20px;
              height: 70px;
              background-color: black;
              border: 2px solid black;
              position: absolute;
              top: 0px;
              float: left;
              display: flex;
              justify-content:center;
              align-items: center;
              z-index: 2;
              left:0px;
            }
      
            .pressed {
              background-color: rgb(255, 123, 0);
            }

            #piano-container {
                display: none;
                position: relative;
            }
          </style>
        
    </head>
    <body>
        
        <h1>Pitch class set information calculator</h1>
        <p>Input your pitch collection in the textbox below using integer notation or letter names <strong>separated by spaces.</strong></p>
        <small>Note: for letter names, format your notes using b for flat, bb for double flat, # for sharp, and x for double sharp notes.</small>
        <br><br>
        <form>
            <label for="input">Input:</label>
            <br>
            <input type="text" id="input" name="input" onchange="updatePiano()">
            <br>
        </form>
        <div id="piano-container">
            <div class="white-key" note-name="C" note-int="0">0</div>
            <div class="black-key" note-name="C#" note-int="1" style="left: 20px">1</div>
            <div class="white-key" note-name="D" note-int="2">2</div>
            <div class="black-key" note-name="D#" note-int="3" style="left: 53px">3</div>
            <div class="white-key" note-name="E" note-int="4">4</div>
            <div class="white-key" note-name="F" note-int="5">5</div>
            <div class="black-key" note-name="F#" note-int="6" style="left: 113px">6</div>
            <div class="white-key" note-name="G" note-int="7">7</div>
            <div class="black-key" note-name="G#" note-int="8"style="left: 143px">8</div>
            <div class="white-key" note-name="A" note-int="9">9</div>
            <div class="black-key" note-name="A#" note-int="10"style="left:174px">10</div>
            <div class="white-key" note-name="B" note-int="11">11</div>
        </div>
        <br><br><br><br><br>
        <button onclick="calculate()">Calculate</div>
        <script>
            const Piano = {
              keys: null,
              initialize: function() {
                this.keys = document.querySelectorAll('.white-key, .black-key');
      
                this.keys.forEach(key => {                  
                  let isPressed = false;
                  key.addEventListener('mousedown', () => {
                    key.classList.toggle('pressed', !isPressed);
                    isPressed = !isPressed;
                    updateInput();
                  });
                });
              },
              show: function() {
                document.getElementById('piano-container').style.display = 'block';
              },
              hide: function(){
                document.getElementById("piano-container").style.display = 'none';
              }
            }

            Piano.initialize();
            Piano.show();

            const Input = document.getElementById("input");
            
            function updateInput(){
              let pressedKeys = document.querySelectorAll(".pressed");
              let pressedKeysArray = Array.from(pressedKeys);
              let pressedKeysInts = pressedKeysArray.map(key => key.getAttribute("note-int"));
              Input.value = pressedKeysInts.join(" ");
            }

            function updatePiano(){
              let inputArray = Input.value.split(" ");
              let inputInts = inputArray.map(key => parseInt(key));
              Piano.keys.forEach(key => {
                let keyInt = parseInt(key.getAttribute("note-int"));
                if(inputInts.includes(keyInt)){
                  key.classList.add("pressed");
                } else {
                  key.classList.remove("pressed");
                }
              });
              Input.value = removeDuplicates(Input.value);
            }

            function removeDuplicates(str){
              let inputArray = str.split(" ");
              let inputInts = inputArray.map(key => parseInt(key));
              let uniqueInts = [...new Set(inputInts)];
              return uniqueInts.join(" ");
            }

            function calculate(){
              console.log(Input);
            }
          </script>
    </body>
</html>
